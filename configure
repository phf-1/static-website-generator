#! /usr/bin/env bash
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.

set -euo pipefail
IFS=$'\n\t'


SOURCE=""
PREFIX="_install"
while (( $# )); do
  case $1 in
	--source)
	  shift
	  SOURCE="$(realpath $1)"
	  ;;
	--prefix)
	  shift
	  PREFIX="$(realpath $1)"
	  ;;
	*)
	  echo "Error. Unexpected argument: "
	  exit 1
	  ;;
  esac
  shift
done


if [[ ! -d "${SOURCE}" ]]; then
  echo '--source ${SOURCE} must be specified and ${SOURCE} must be a directory.'
  exit 1
fi


chmod +w Makefile
sed "s|__PREFIX__|${PREFIX}|g" Makefile.in > Makefile
sed -i "s|__SOURCE__|${SOURCE}|g" Makefile
chmod -w Makefile
echo Makefile
echo "  SOURCE = ${SOURCE}"
echo "  PREFIX = ${PREFIX}"
